---
#PRE CONFIGS DOCKER
- name: Create docker custom config directory
  file: path={{ item.path }} state=directory mode="a+rw"
  with_items:
      - { path: '/etc/systemd/system/docker.service.d' }
      - { path: '/etc/docker/' }

# - name: Configure Docker
#   template:
#       src=default_docker.j2
#       dest=/etc/default/docker
#       mode=0644
#       owner=root
#       group=root
#  notify: stop docker

- name: Override Docker config
  template:
      src=override.conf.j2
      dest=/etc/systemd/system/docker.service.d/override.conf
      mode=0644
      owner=root
      group=root
#  notify: stop docker

- name: Configure Docker Images Path
  template:
      src=daemon.json.j2
      dest=/etc/docker/daemon.json
      mode=0644
      owner=root
      group=root
  # notify: 
  #   - reload systemd
  #   - restart docker

#INSTALL DOCKER
# - name: Install Docker package
#   apt:
#       name={{ docker_package }}
#       update_cache=yes

- name: Install Docker compatible version
  shell: curl https://releases.rancher.com/install-docker/17.03.sh | sh
  args:
    warn: false
  register: docker_installed
  tags: docker
  delay: 10
  ignore_errors: true
